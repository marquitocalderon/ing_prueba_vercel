<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <a href="/salir">Salir</a>

    <form action="/principal" method="POST" id="unidad-form">
        <label for="nombre">Nombre de la unidad:</label>
        <input type="text" id="nombre" name="nombre_unidad" required>
      
        <label for="estado">Estado:</label>
        <input type="text" id="estado" name="estado_unidad">
      
        <input type="submit" value="Registrar unidad">
    </form>

    <table id="tabla-unidades">
        <thead>
            <tr>
                <th>Nombre de la unidad</th>
                <th>Estado</th>
            </tr>
        </thead>
        <tbody>
            <% results.forEach(function(result) { %>
                <tr>
                    <td><%= result.nombre_unidad %></td>
                    <td><%= result.estado_unidad %></td>
                </tr>
            <% }); %>
        </tbody>
    </table>

    <script>
        document.getElementById('unidad-form').addEventListener('submit', function(event) {
            event.preventDefault(); // Evita el comportamiento predeterminado del formulario

            // Obtén los valores de los campos de entrada
            const nombreUnidad = document.getElementById('nombre').value;
            const estadoUnidad = document.getElementById('estado').value;

            // Crea un objeto de datos para enviar al servidor
            const data = {
                nombre_unidad: nombreUnidad,
                estado_unidad: estadoUnidad
            };

            // Envía los datos utilizando Axios
            axios.post('/principal', data)
                .then(function(response) {
                    // Realiza acciones después de que se envíen los datos correctamente
                    console.log(response.data);
                    Swal.fire({
                        icon: 'success',
                        title: 'Inserción exitosa',
                        text: 'Los datos se han registrado correctamente.',
                    });

                    // Agrega una nueva fila a la tabla con los datos ingresados
                    const tablaUnidades = document.getElementById('tabla-unidades').getElementsByTagName('tbody')[0];
                    const nuevaFila = document.createElement('tr');
                    nuevaFila.innerHTML = `
                        <td>${nombreUnidad}</td>
                        <td>${estadoUnidad}</td>
                    `;
                    tablaUnidades.appendChild(nuevaFila);

                    // Limpia los campos del formulario
                    document.getElementById('unidad-form').reset();
                })
                .catch(function(error) {
                    // Maneja los errores que ocurran durante el envío de datos
                    console.error(error);
                });
        });
    </script>
</body>
</html>
